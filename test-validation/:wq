---
Name: "test-validation-set-remediated"
Description: "Handles the remediation toggling for fail immediately resume test."
Documentation: |
  This task does two things for the ``test-validation-fail-immediately`` testing.

    1. If the ``test-validation/remediated`` is ``false``, set it to ``true`` and exit
    2. If the ``test-validation/remediated`` is ``true``, simply note that, and continue

  Subsequently, in the ``test-validation-fail-immediately`` task, if the Param is
  set to ``true``, the test will succeed instead of failing.

Meta:
  color: "blue"
  icon: "bug"
  title: "RackN Content"
  feature-flags: "sane-exit-codes"
Templates:
- Name: "test_validation_set_remediated.sh"
  Contents: |
    #!/bin/bash
    # Copyright RackN, 2019

    set -e

    {{ template "setup.tmpl" . }}
    {{ template "validation-lib.tmpl" . }}

    {{ if eq ( .Param "test-validation/remediated" ) false }}
    echo "The remdiated param is false - toggling it to true."
    set_param "test-validation/remediated" true
    {{ else -}}
    echo "The remediated param is true - this workflow should succeed."
    {{ end -}}

    exit 0

